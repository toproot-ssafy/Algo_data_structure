var fs = require("fs");
var path = require("path");
var execSync = require("child_process").execSync;

var basePath = path.join(path.dirname(require.resolve("./index.js")));
var tonicPath = path.join(basePath, ".tonic");

module.exports = function(notebookPath)
{
    if (!fs.existsSync(tonicPath)) {
        fs.mkdirSync(tonicPath)
    }

    var module = notebookPath.split("/")[1];
    var parentPath = path.join(tonicPath, notebookPath.replace(/\//g, "_"));
    var modulePath = path.join(parentPath, "node_modules");
    var requirePath = path.join(modulePath, module);

    if (!fs.existsSync(parentPath)) {
        fs.mkdirSync(parentPath)
    }

    if (!fs.existsSync(modulePath)) {
        fs.mkdirSync(modulePath)
    }

    if (!fs.existsSync(requirePath)) {
        execSync("npm install https://tonicdev.com/" + notebookPath, { cwd: parentPath })
    }

    return require(requirePath);
}
